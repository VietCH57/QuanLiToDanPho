{% extends 'base.html' %}

{% block title %}Qu·∫£n l√Ω ph√°t th∆∞·ªüng - Admin{% endblock %}

{% block extra_css %}
<style>
    .page-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .page-header {
        text-align: center;
        margin-bottom: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 40px 20px;
        border-radius: 15px;
        color: white;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .page-header h1 {
        font-size: 36px;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-align: center;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .stat-card h4 {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .stat-card .stat-value {
        color: #667eea;
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .stat-card .stat-label {
        color: #999;
        font-size: 13px;
    }

    .table-container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        overflow-x: auto;
    }

    .table-container h3 {
        color: #333;
        font-size: 24px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .data-table th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
    }

    .data-table td {
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
    }

    .data-table tbody tr:hover {
        background: #f8f9fa;
    }

    .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-open {
        background: #d4edda;
        color: #155724;
    }

    .badge-closed {
        background: #f8d7da;
        color: #721c24;
    }

    .badge-processing {
        background: #fff3cd;
        color: #856404;
    }

    .badge-done {
        background: #d1ecf1;
        color: #0c5460;
    }

    .badge-khenthuong {
        background: #e3f2fd;
        color: #1976d2;
    }

    .badge-letet {
        background: #fff9c4;
        color: #f57f17;
    }

    .btn-action {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        margin-right: 5px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
        background: linear-gradient(135deg, #38f9d7 0%, #43e97b 100%);
        color: white;
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(56, 249, 215, 0.4);
    }

    .btn-warning {
        background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
        color: white;
    }

    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
    }

    .alert-success {
        background: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
    }

    .alert-error {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }

    .form-select-inline {
        padding: 5px 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 13px;
    }

    .search-form .form-control {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
    }

    .search-form .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn-action {
        padding: 8px 15px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 13px;
        font-weight: 600;
        display: inline-block;
        transition: all 0.3s ease;
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1>üìä Qu·∫£n l√Ω ph√°t th∆∞·ªüng</h1>
        <p>Th·ªëng k√™ v√† qu·∫£n l√Ω c√°c ƒë·ª£t ph√°t th∆∞·ªüng</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div class="stats-grid">
        <div class="stat-card">
            <h4>T·ªïng ph·∫ßn th∆∞·ªüng ƒë√£ ph√°t</h4>
            <div class="stat-value">{{ tong_phat_thuong }}</div>
            <div class="stat-label">ph·∫ßn th∆∞·ªüng</div>
        </div>
        <div class="stat-card">
            <h4>T·ªïng gi√° tr·ªã</h4>
            <div class="stat-value" style="font-size: 24px;">{{ tong_gia_tri|floatformat:0 }}</div>
            <div class="stat-label">VNƒê</div>
        </div>
        <div class="stat-card">
            <h4>Th√†nh t√≠ch ch·ªù duy·ªát</h4>
            <div class="stat-value">{{ pending_count }}</div>
            <div class="stat-label">h·ªì s∆°</div>
        </div>
        <div class="stat-card">
            <h4>Th√†nh t√≠ch ƒë√£ duy·ªát</h4>
            <div class="stat-value">{{ approved_count }}</div>
            <div class="stat-label">h·ªì s∆°</div>
        </div>
    </div>

    <!-- Danh s√°ch ƒë·ª£t ph√°t th∆∞·ªüng -->
    <div class="table-container">
        <h3>üìã Danh s√°ch ƒë·ª£t ph√°t th∆∞·ªüng</h3>
        
        <!-- Form t√¨m ki·∫øm -->
        <form method="GET" class="search-form" style="margin-bottom: 25px;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: end;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label style="margin-bottom: 5px; font-size: 13px; color: #666;">T√¨m ki·∫øm theo t√™n ho·∫∑c m√¥ t·∫£</label>
                    <input type="text" name="search" class="form-control" placeholder="Nh·∫≠p t√™n ƒë·ª£t ho·∫∑c m√¥ t·∫£..." value="{{ search_query }}" style="padding: 10px 15px;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label style="margin-bottom: 5px; font-size: 13px; color: #666;">Lo·∫°i ƒë·ª£t</label>
                    <select name="loai_dot" class="form-select-inline" style="padding: 10px 15px; width: 100%;">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="KhenThuong" {% if loai_dot_filter == 'KhenThuong' %}selected{% endif %}>üèÜ Khen th∆∞·ªüng</option>
                        <option value="LeTet" {% if loai_dot_filter == 'LeTet' %}selected{% endif %}>üéâ L·ªÖ T·∫øt</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label style="margin-bottom: 5px; font-size: 13px; color: #666;">Tr·∫°ng th√°i</label>
                    <select name="trang_thai" class="form-select-inline" style="padding: 10px 15px; width: 100%;">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="DangMo" {% if trang_thai_filter == 'DangMo' %}selected{% endif %}>‚úÖ ƒêang m·ªü</option>
                        <option value="DaDong" {% if trang_thai_filter == 'DaDong' %}selected{% endif %}>üîí ƒê√£ ƒë√≥ng</option>
                        <option value="DangPhat" {% if trang_thai_filter == 'DangPhat' %}selected{% endif %}>‚è≥ ƒêang ph√°t</option>
                        <option value="HoanThanh" {% if trang_thai_filter == 'HoanThanh' %}selected{% endif %}>‚úîÔ∏è Ho√†n th√†nh</option>
                    </select>
                </div>
                <button type="submit" class="btn-action btn-primary" style="padding: 10px 25px; white-space: nowrap;">üîç T√¨m ki·∫øm</button>
            </div>
        </form>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>Lo·∫°i</th>
                    <th>T√™n ƒë·ª£t</th>
                    <th>NƒÉm h·ªçc</th>
                    <th>Th·ªùi gian</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H·ªì s∆°</th>
                    <th>Ng∆∞·ªùi t·∫°o</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                {% for dot in dot_phat_list %}
                <tr>
                    <td>
                        {% if dot.loai_dot == 'KhenThuong' %}
                            <span class="badge badge-khenthuong">üèÜ Khen th∆∞·ªüng</span>
                        {% else %}
                            <span class="badge badge-letet">üéâ L·ªÖ T·∫øt</span>
                        {% endif %}
                    </td>
                    <td><strong>{{ dot.ten_dot }}</strong></td>
                    <td>{{ dot.nam_hoc }}</td>
                    <td>{{ dot.ngay_bat_dau|date:"d/m/Y" }} - {{ dot.ngay_ket_thuc|date:"d/m/Y" }}</td>
                    <td>
                        <form method="POST" action="{% url 'users:cap_nhat_trang_thai_dot' dot.id %}" style="display: inline;">
                            {% csrf_token %}
                            <select name="trang_thai" class="form-select-inline" onchange="this.form.submit()">
                                <option value="DangMo" {% if dot.trang_thai == 'DangMo' %}selected{% endif %}>‚úÖ ƒêang m·ªü</option>
                                <option value="DaDong" {% if dot.trang_thai == 'DaDong' %}selected{% endif %}>üîí ƒê√£ ƒë√≥ng</option>
                                <option value="DangPhat" {% if dot.trang_thai == 'DangPhat' %}selected{% endif %}>‚è≥ ƒêang ph√°t</option>
                                <option value="HoanThanh" {% if dot.trang_thai == 'HoanThanh' %}selected{% endif %}>‚úîÔ∏è Ho√†n th√†nh</option>
                            </select>
                        </form>
                    </td>
                    <td><strong>{{ dot.danh_sach_thanh_tich.count }}</strong> h·ªì s∆°</td>
                    <td>{{ dot.nguoi_tao.get_full_name }}</td>
                    <td>
                        <a href="{% url 'users:chi_tiet_dot_phat_thuong' dot.id %}" class="btn-action btn-primary" style="margin-bottom: 5px;">
                            üìä Xem chi ti·∫øt
                        </a>
                        {% if dot.loai_dot == 'KhenThuong' %}
                            <a href="{% url 'users:duyet_thanh_tich_theo_dot' dot.id %}" class="btn-action" style="background: #43e97b; color: white; margin-bottom: 5px;">
                                üìù Duy·ªát th√†nh t√≠ch
                            </a>
                        {% endif %}
                        <a href="{% url 'users:sua_dot_phat_thuong' dot.id %}" class="btn-action" style="background: #ffa502; color: white; margin-bottom: 5px;">
                            ‚úèÔ∏è S·ª≠a
                        </a>
                        <a href="{% url 'users:xoa_dot_phat_thuong' dot.id %}" class="btn-action" style="background: #ff6348; color: white;" 
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë·ª£t {{ dot.ten_dot }}? Kh√¥ng th·ªÉ ho√†n t√°c!');">
                            üóëÔ∏è X√≥a
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                        Ch∆∞a c√≥ ƒë·ª£t ph√°t th∆∞·ªüng n√†o
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

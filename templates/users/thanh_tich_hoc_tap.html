{% extends 'base.html' %}

{% block title %}Th√†nh t√≠ch h·ªçc t·∫≠p - H·ªá th·ªëng Qu·∫£n l√Ω{% endblock %}

{% block extra_css %}
<style>
    .page-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .page-header {
        text-align: center;
        margin-bottom: 40px;
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        padding: 40px 20px;
        border-radius: 15px;
        color: white;
        box-shadow: 0 10px 30px rgba(67, 233, 123, 0.3);
    }

    .page-header h1 {
        font-size: 36px;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        justify-content: center;
    }

    .btn-action {
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-add {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-add:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .achievement-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        border-left: 5px solid;
    }

    .achievement-card.pending {
        border-left-color: #ffd93d;
    }

    .achievement-card.approved {
        border-left-color: #6bcf7f;
    }

    .achievement-card.rejected {
        border-left-color: #ff6b6b;
    }

    .achievement-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .card-title {
        font-size: 20px;
        font-weight: 700;
        color: #333;
    }

    .card-badge {
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-pending {
        background: #ffd93d;
        color: #333;
    }

    .badge-approved {
        background: #6bcf7f;
        color: white;
    }

    .badge-rejected {
        background: #ff6b6b;
        color: white;
    }

    .card-info {
        margin-bottom: 10px;
        color: #666;
        font-size: 14px;
    }

    .card-info strong {
        color: #333;
        font-weight: 600;
    }

    .card-image {
        margin: 15px 0;
        text-align: center;
    }

    .card-image img {
        max-width: 100%;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .card-image a {
        color: #667eea;
        text-decoration: underline;
        font-weight: 600;
    }

    .card-footer {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #f0f0f0;
        font-size: 13px;
        color: #999;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
    }

    .alert-success {
        background: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
    }

    .alert-error {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .empty-state-icon {
        font-size: 80px;
        margin-bottom: 20px;
    }

    .empty-state h3 {
        color: #333;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #666;
        font-size: 16px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .modal-header h3 {
        margin: 0;
        color: #333;
        font-size: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn-submit {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(67, 233, 123, 0.4);
    }

    .btn-cancel {
        background: #95a5a6;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 10px;
    }

    .btn-cancel:hover {
        background: #7f8c8d;
    }

    .help-text {
        font-size: 12px;
        color: #999;
        margin-top: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1>üèÜ Th√†nh t√≠ch h·ªçc t·∫≠p c·ªßa t√¥i</h1>
        <p>Khai b√°o v√† theo d√µi th√†nh t√≠ch h·ªçc t·∫≠p</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if dot_dang_mo %}
    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <h3 style="color: #856404; margin-bottom: 15px;">üì¢ Th√¥ng b√°o c√°c ƒë·ª£t ph√°t th∆∞·ªüng ƒëang m·ªü</h3>
        {% for dot in dot_dang_mo %}
        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
            <strong style="font-size: 16px; color: #333;">{{ dot.ten_dot }}</strong><br>
            <span style="color: #666;">
                üìÖ H·∫°n n·ªôp: {{ dot.ngay_ket_thuc|date:"d/m/Y" }}
            </span>
            {% if dot.mo_ta %}
            <p style="margin: 10px 0 0 0; color: #666;">{{ dot.mo_ta }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 20px; border-radius: 8px; margin-bottom: 30px; color: #721c24;">
        <strong>‚ö†Ô∏è Hi·ªán kh√¥ng c√≥ ƒë·ª£t ph√°t th∆∞·ªüng n√†o ƒëang m·ªü.</strong><br>
        Vui l√≤ng ch·ªù c√°n b·ªô t·∫°o ƒë·ª£t ph√°t th∆∞·ªüng m·ªõi.
    </div>
    {% endif %}

    <div class="action-buttons">
        {% if dot_dang_mo %}
        <button class="btn-action btn-add" onclick="openAddModal()">
            ‚ûï Khai b√°o th√†nh t√≠ch m·ªõi
        </button>
        {% endif %}
    </div>

    {% if thanh_tich_list %}
    <div class="card-container">
        {% for tt in thanh_tich_list %}
        <div class="achievement-card {% if tt.trang_thai == 'ChoDuyet' %}pending{% elif tt.trang_thai == 'DaDuyet' %}approved{% else %}rejected{% endif %}">
            <div class="card-header">
                <div class="card-title">{{ tt.ho_ten|default:tt.thanh_vien.ho_ten }}</div>
                <div>
                    {% if tt.trang_thai == 'ChoDuyet' %}
                        <span class="card-badge badge-pending">‚è≥ Ch·ªù duy·ªát</span>
                    {% elif tt.trang_thai == 'DaDuyet' %}
                        <span class="card-badge badge-approved">‚úÖ ƒê√£ duy·ªát</span>
                    {% else %}
                        <span class="card-badge badge-rejected">‚ùå T·ª´ ch·ªëi</span>
                    {% endif %}
                </div>
            </div>

            <div class="card-info" style="background: #e3f2fd; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                <strong>ƒê·ª£t ph√°t th∆∞·ªüng:</strong> {{ tt.dot_phat_thuong.ten_dot }}
            </div>

            <div class="card-info">
                <strong>Tr∆∞·ªùng:</strong> {{ tt.truong }}
            </div>
            <div class="card-info">
                <strong>L·ªõp:</strong> {{ tt.lop }}
            </div>
            <div class="card-info">
                <strong>Th√†nh t√≠ch:</strong> 
                {% if tt.thanh_tich == 'HocSinhGioi' %}
                    ‚≠ê H·ªçc sinh gi·ªèi
                {% elif tt.thanh_tich == 'ThanhTichDacBiet' %}
                    üèÜ Th√†nh t√≠ch ƒë·∫∑c bi·ªát
                {% elif tt.thanh_tich == 'HocSinhTienTien' %}
                    ‚ú® H·ªçc sinh ti√™n ti·∫øn
                {% else %}
                    üìö {{ tt.get_thanh_tich_display }}
                {% endif %}
            </div>

            {% if tt.minh_chung %}
            <div class="card-image">
                <a href="{{ tt.minh_chung.url }}" target="_blank">
                    üìé Xem minh ch·ª©ng
                </a>
            </div>
            {% endif %}

            {% if tt.trang_thai == 'TuChoi' and tt.ly_do_tu_choi %}
            <div class="card-info" style="color: #e74c3c; background: #fff5f5; padding: 10px; border-radius: 6px; margin-top: 10px;">
                <strong>L√Ω do t·ª´ ch·ªëi:</strong><br>
                {{ tt.ly_do_tu_choi }}
            </div>
            {% endif %}

            <div class="card-footer">
                Khai b√°o ng√†y: {{ tt.ngay_tao|date:"d/m/Y H:i" }}
                {% if tt.trang_thai != 'ChoDuyet' %}
                    <br>Duy·ªát b·ªüi: {{ tt.nguoi_duyet.get_full_name }} - {{ tt.ngay_duyet|date:"d/m/Y" }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üìö</div>
        <h3>Ch∆∞a c√≥ th√†nh t√≠ch n√†o</h3>
        <p>H√£y khai b√°o th√†nh t√≠ch h·ªçc t·∫≠p c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n ph·∫ßn th∆∞·ªüng!</p>
    </div>
    {% endif %}
</div>

<!-- Modal th√™m th√†nh t√≠ch -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üìù Khai b√°o th√†nh t√≠ch h·ªçc t·∫≠p</h3>
        </div>

        <form method="POST" action="{% url 'users:gui_thanh_tich' %}" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group">
                <label>Ch·ªçn ƒë·ª£t ph√°t th∆∞·ªüng <span style="color: red;">*</span></label>
                <select name="dot_phat_thuong_id" class="form-select" required>
                    <option value="">-- Ch·ªçn ƒë·ª£t ph√°t th∆∞·ªüng --</option>
                    {% for dot in dot_dang_mo %}
                    <option value="{{ dot.id }}">{{ dot.ten_dot }}</option>
                    {% endfor %}
                </select>
                <div class="help-text">Ch·ªçn ƒë·ª£t ph√°t th∆∞·ªüng ph√π h·ª£p</div>
            </div>

            <div class="form-group">
                <label>H·ªç t√™n h·ªçc sinh <span style="color: red;">*</span></label>
                <input type="text" name="ho_ten" class="form-control" placeholder="Nh·∫≠p h·ªç t√™n h·ªçc sinh c√≥ th√†nh t√≠ch" required>
                <div class="help-text">Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß c·ªßa h·ªçc sinh</div>
            </div>

            <div class="form-group">
                <label>Tr∆∞·ªùng <span style="color: red;">*</span></label>
                <input type="text" name="truong" class="form-control" placeholder="V√≠ d·ª•: THCS Nguy·ªÖn Du" required>
            </div>

            <div class="form-group">
                <label>L·ªõp <span style="color: red;">*</span></label>
                <input type="text" name="lop" class="form-control" placeholder="V√≠ d·ª•: 7A1" required>
            </div>

            <div class="form-group">
                <label>Th√†nh t√≠ch <span style="color: red;">*</span></label>
                <select name="thanh_tich" class="form-select" required>
                    <option value="">-- Ch·ªçn th√†nh t√≠ch --</option>
                    <option value="HocSinhGioi">‚≠ê H·ªçc sinh gi·ªèi (10 quy·ªÉn v·ªü)</option>
                    <option value="ThanhTichDacBiet">üèÜ Th√†nh t√≠ch ƒë·∫∑c bi·ªát (10 quy·ªÉn v·ªü)</option>
                    <option value="HocSinhTienTien">‚ú® H·ªçc sinh ti√™n ti·∫øn (7 quy·ªÉn v·ªü)</option>
                    <option value="Khac">üìö Kh√°c (5 quy·ªÉn v·ªü)</option>
                </select>
                <div class="help-text">Ch·ªçn th√†nh t√≠ch ph√π h·ª£p v·ªõi gi·∫•y khen/b·∫±ng c·ªßa b·∫°n</div>
            </div>

            <div class="form-group">
                <label>Minh ch·ª©ng (·∫¢nh gi·∫•y khen/b·∫±ng) <span style="color: red;">*</span></label>
                <input type="file" name="minh_chung" class="form-control" accept="image/*" required>
                <div class="help-text">Ch·ª•p ·∫£nh r√µ n√©t gi·∫•y khen ho·∫∑c b·∫±ng khen c·ªßa b·∫°n</div>
            </div>

            <button type="submit" class="btn-submit">
                üéØ G·ª≠i khai b√°o
            </button>
            <button type="button" class="btn-cancel" onclick="closeAddModal()">
                H·ªßy
            </button>
        </form>
    </div>
</div>

<script>
function openAddModal() {
    document.getElementById('addModal').style.display = 'flex';
}

function closeAddModal() {
    document.getElementById('addModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('addModal');
    if (event.target == modal) {
        closeAddModal();
    }
}
</script>
{% endblock %}

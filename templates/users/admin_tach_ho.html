{% extends 'base.html' %}

{% block title %}T√°ch h·ªô - {{ ho.ma_ho }}{% endblock %}

{% block extra_css %}
<style>
    .split-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px;
    }

    .split-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px;
        background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
        color: white;
        border-radius: 15px;
    }

    .split-header h2 {
        margin: 0 0 10px 0;
        font-size: 28px;
    }

    .info-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .info-card h3 {
        color: #EC4899;
        margin-bottom: 20px;
        font-size: 20px;
    }

    .info-row {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-row .label {
        font-weight: 600;
        color: #666;
        min-width: 180px;
    }

    .info-row .value {
        color: #333;
    }

    .form-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .form-card h3 {
        color: #EC4899;
        margin-bottom: 20px;
        font-size: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }

    .form-group input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
    }

    .form-group input:focus {
        outline: none;
        border-color: #EC4899;
    }

    .members-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .members-table thead {
        background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
        color: white;
    }

    .members-table th {
        padding: 15px 10px;
        text-align: left;
        font-weight: 600;
    }

    .members-table tbody tr {
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s;
    }

    .members-table tbody tr:hover {
        background: #FCE7F3;
    }

    .members-table tbody tr.selected {
        background: #FBCFE8;
    }

    .members-table td {
        padding: 12px 10px;
        color: #333;
    }

    .checkbox-cell {
        width: 50px;
        text-align: center;
    }

    .checkbox-cell input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge.chu-ho {
        background: #EC4899;
        color: white;
    }

    .warning-box {
        background: #FEF3C7;
        border-left: 4px solid #F59E0B;
        padding: 15px 20px;
        margin: 20px 0;
        border-radius: 8px;
    }

    .warning-box p {
        margin: 0;
        color: #92400E;
    }

    .btn-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
    }

    .btn {
        padding: 12px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s;
        cursor: pointer;
        border: none;
    }

    .btn-primary {
        background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
    }

    .btn-secondary {
        background: #e0e0e0;
        color: #666;
    }

    .btn-secondary:hover {
        background: #d0d0d0;
    }

    .selected-count {
        background: #FBCFE8;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-weight: 600;
        color: #831843;
        margin: 15px 0;
    }
</style>

<script>
    function updateSelectedCount() {
        const checkboxes = document.querySelectorAll('input[name="tach_ids"]:checked');
        const count = checkboxes.length;
        const countDisplay = document.getElementById('selected-count');
        if (countDisplay) {
            countDisplay.textContent = `ƒê√£ ch·ªçn ${count} th√†nh vi√™n`;
        }
        
        // Highlight selected rows
        document.querySelectorAll('.members-table tbody tr').forEach(row => {
            const checkbox = row.querySelector('input[type="checkbox"]');
            if (checkbox && checkbox.checked) {
                row.classList.add('selected');
            } else {
                row.classList.remove('selected');
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Add event listeners to checkboxes
        document.querySelectorAll('input[name="tach_ids"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedCount);
        });
        
        // Initialize count
        updateSelectedCount();
    });
</script>
{% endblock %}

{% block content %}
<div class="split-container">
    <div class="split-header">
        <h2>üè† T√°ch h·ªô kh·∫©u</h2>
        <p style="margin: 0; opacity: 0.9;">T·∫°o h·ªô m·ªõi t·ª´ c√°c th√†nh vi√™n ƒë∆∞·ª£c ch·ªçn</p>
    </div>

    <!-- Th√¥ng tin h·ªô c≈© -->
    <div class="info-card">
        <h3>üìã Th√¥ng tin H·ªô hi·ªán t·∫°i</h3>
        <div class="info-row">
            <span class="label">M√£ h·ªô:</span>
            <span class="value">{{ ho.ma_ho }}</span>
        </div>
        <div class="info-row">
            <span class="label">ƒê·ªãa ch·ªâ:</span>
            <span class="value">{{ ho.dia_chi }}</span>
        </div>
        <div class="info-row">
            <span class="label">Ch·ªß h·ªô:</span>
            <span class="value">{{ ho.chu_ho.ho_ten|default:"Ch∆∞a c√≥" }}</span>
        </div>
        <div class="info-row">
            <span class="label">T·ªïng s·ªë th√†nh vi√™n:</span>
            <span class="value">{{ thanh_vien_trong_ho.count }} ng∆∞·ªùi</span>
        </div>
    </div>

    <div class="warning-box">
        <p>‚ö†Ô∏è <strong>L∆∞u √Ω:</strong> H√£y ch·ªçn c√°c th√†nh vi√™n mu·ªën t√°ch sang h·ªô m·ªõi v√† ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin h·ªô m·ªõi b√™n d∆∞·ªõi.</p>
    </div>

    <!-- Form t√°ch h·ªô -->
    <form method="post">
        {% csrf_token %}
        
        <!-- Th√¥ng tin h·ªô m·ªõi -->
        <div class="form-card">
            <h3>üÜï Th√¥ng tin H·ªô m·ªõi</h3>
            <div class="form-group">
                <label>M√£ h·ªô m·ªõi <span style="color: #EF4444;">*</span></label>
                <input type="text" name="ma_ho_moi" required placeholder="VD: HK999">
            </div>
            <div class="form-group">
                <label>ƒê·ªãa ch·ªâ m·ªõi <span style="color: #EF4444;">*</span></label>
                <input type="text" name="dia_chi_moi" required placeholder="VD: 123 ƒê∆∞·ªùng ABC, Ph∆∞·ªùng XYZ">
            </div>
            <div class="form-group">
                <label>Ch·ªçn ch·ªß h·ªô m·ªõi <span style="color: #EF4444;">*</span></label>
                <select name="chu_ho_moi" id="chu_ho_moi" required>
                    <option value="">-- Ch·ªçn ch·ªß h·ªô m·ªõi --</option>
                    {% for tv in thanh_vien_trong_ho %}
                        <option value="{{ tv.id }}">{{ tv.ho_ten }} ({{ tv.ngay_sinh|date:"d/m/Y" }})</option>
                    {% endfor %}
                </select>
                <small>Ch·ªâ c√°c th√†nh vi√™n ƒë∆∞·ª£c ch·ªçn t√°ch m·ªõi c√≥ th·ªÉ l√†m ch·ªß h·ªô m·ªõi.</small>
            </div>
        </div>

        <!-- Danh s√°ch th√†nh vi√™n -->
        <div class="form-card">
            <h3>üë• Ch·ªçn th√†nh vi√™n t√°ch sang h·ªô m·ªõi</h3>
            <div id="selected-count" class="selected-count">ƒê√£ ch·ªçn 0 th√†nh vi√™n</div>
            
            <table class="members-table">
                <thead>
                    <tr>
                        <th class="checkbox-cell">Ch·ªçn</th>
                        <th>H·ªç v√† t√™n</th>
                        <th>Ng√†y sinh</th>
                        <th>Gi·ªõi t√≠nh</th>
                        <th>CCCD</th>
                        <th>Vai tr√≤</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tv in thanh_vien_trong_ho %}
                    <tr>
                        <td class="checkbox-cell">
                            <input type="checkbox" name="tach_ids" value="{{ tv.id }}">
                        </td>
                        <td>{{ tv.ho_ten }}</td>
                        <td>{{ tv.ngay_sinh|date:"d/m/Y" }}</td>
                        <td>{{ tv.get_gioi_tinh_display|default:"-" }}</td>
                        <td>{{ tv.cccd|default:"Ch∆∞a c√≥" }}</td>
                        <td>
                            {% if tv.la_chu_ho %}
                                <span class="badge chu-ho">Ch·ªß h·ªô</span>
                            {% else %}
                                {{ tv.quan_he_chu_ho|default:"Th√†nh vi√™n" }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Buttons -->
        <div class="btn-container">
            <button type="submit" class="btn btn-primary">‚úì X√°c nh·∫≠n t√°ch h·ªô</button>
            <a href="{% url 'users:ho_khau' %}" class="btn btn-secondary">‚úï H·ªßy b·ªè</a>
        </div>
    </form>
</div>
{% endblock %}
